// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  READER
  JOURNALIST
  ADMIN
}

enum ArticleStatus {
  DRAFT
  UNDER_REVIEW
  PUBLISHED
  REJECTED
  CORRECTED
}

enum FactCheckType {
  AI
  HUMAN
}

enum FactCheckStatus {
  APPROVED
  REJECTED
  FLAGGED
}

enum BiasType {
  LEFT
  RIGHT
  CENTER
  NEUTRAL
  UNKNOWN
}

enum FlagReason {
  INCORRECT_FACT
  MISLEADING
  BIAS
  HATE_SPEECH
}

enum ModerationAction {
  WARN
  TAKE_DOWN
  RESTORE
}

enum SubscriptionStatus {
  ACTIVE
  PAUSED
  CANCELED
  EXPIRED
}

enum SubscriptionTier {
  FREE
  PREMIUM
}

enum LedgerType {
  TIP
  SUBSCRIPTION
  COMMISSION
}

enum MediaType {
  IMAGE
  VIDEO
  PDF
  AUDIO
}

model User {
  id       String @id @default(uuid())
  email    String @unique
  password String
  role     Role   @default(READER)

  journalistProfile JournalistProfile?

  comments      Comment[]
  flags         Flag[]
  tips          Tip[]
  subscriptions Subscription[] @relation("UserSubscriptions")

  createdAt DateTime @default(now())
}

model JournalistProfile {
  id     String @id @default(uuid())
  userId String @unique

  bio               String?
  verified          Boolean @default(false)
  politicalStanding String?
  credibilityScore  Float   @default(0)

  user        User          @relation(fields: [userId], references: [id])
  articles    Article[]
  earnings    LedgerEntry[]
  subscribers Subscription[]

  createdAt DateTime @default(now())
}

model Subscription {
  id           String @id @default(uuid())
  subscriberId String
  journalistId String

  status SubscriptionStatus @default(ACTIVE)
  tier   SubscriptionTier   @default(FREE)

  subscriber User              @relation("UserSubscriptions", fields: [subscriberId], references: [id])
  journalist JournalistProfile @relation(fields: [journalistId], references: [id])

  createdAt DateTime @default(now())

  @@unique([subscriberId, journalistId])
  @@index([journalistId, status])
}

model Article {
  id      String @id @default(uuid())
  title   String
  content String

  status ArticleStatus @default(DRAFT)
  bias   BiasType?

  authorId String
  author   JournalistProfile @relation(fields: [authorId], references: [id])

  factChecks FactCheck[]
  comments   Comment[]
  flags      Flag[]
  tips       Tip[]
  media      ArticleMedia[]
  tags       Tag[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([authorId])
}

model Tag {
  id   String @id @default(uuid())
  name String @unique

  articles Article[]
}

model ArticleMedia {
  id        String    @id @default(uuid())
  articleId String
  type      MediaType
  url       String

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([articleId])
}

model FactCheck {
  id          String @id @default(uuid())
  articleId   String

  type        FactCheckType
  status      FactCheckStatus
  result      Json
  confidence  Float?
  reviewerId  String?
  reviewNotes String?

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([articleId, type])
}

model Flag {
  id        String     @id @default(uuid())
  reason    FlagReason
  articleId String
  userId    String

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())

  @@unique([articleId, userId])
}

model Comment {
  id        String @id @default(uuid())
  content   String
  articleId String
  userId    String

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
}

model LedgerEntry {
  id           String @id @default(uuid())
  journalistId String

  amount      Float
  type        LedgerType
  referenceId String?

  journalist JournalistProfile @relation(fields: [journalistId], references: [id])

  createdAt DateTime @default(now())
}

model Tip {
  id        String @id @default(uuid())
  userId    String
  articleId String

  amount Float

  user    User    @relation(fields: [userId], references: [id])
  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}

model ModerationLog {
  id       String           @id @default(uuid())
  adminId  String
  action   ModerationAction
  targetId String
  reason   String?

  createdAt DateTime @default(now())
}
